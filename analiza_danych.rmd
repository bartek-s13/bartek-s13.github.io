---
title: "Projekt z analizy danych"
author: "Bartłomiej Smolski"
date: "`r format(Sys.Date(), '%d-%m-%Y')`"
output: 
  html_document: 
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache=TRUE)
```

# Wczytanie bibliotek
```{r biblioteki, result='hide'}
library(dplyr, warn.conflicts = FALSE)
library(tidyr, warn.conflicts = FALSE)
library(ggplot2, warn.conflicts = FALSE)
library(readxl, warn.conflicts = FALSE)
library(plotly, warn.conflicts = FALSE)
```

```{r funkcje, echo=FALSE, result='hide'}
f <- function(col1, col2) {
    if (is.na(col1)) {
      col2
    } else if (is.na(col2)) {
      col1
    } else {
      mean(c(col1, col2))
    }
}

f <-Vectorize(f)  

```

# Zapewnienie powtarzalności
```{r powtarzalność, result='hide'}
set.seed(997)
```



# Wczytanie danych

```{r wczytanie, result='hide'}
bitcoin_diff <- read.csv("data/Bitcoin/BCHAIN-DIFF.csv", header=TRUE)
bitcoin_diff[,1] <- as.POSIXct(strptime(bitcoin_diff[,1], "%Y-%m-%d"))

bitcoin_hrate <- read.csv("data/Bitcoin/BCHAIN-HRATE.csv", header=TRUE)
bitcoin_hrate[,1] <- as.POSIXct(strptime(bitcoin_hrate[,1], "%Y-%m-%d"))

bitcoin_mkpru <- read.csv("data/Bitcoin/BCHAIN-MKPRU.csv", header=TRUE)
bitcoin_mkpru[,1] <- as.POSIXct(strptime(bitcoin_mkpru[,1], "%Y-%m-%d"))

bitcoin_trvou <- read.csv("data/Bitcoin/BCHAIN-TRVOU.csv", header=TRUE)
bitcoin_trvou[,1] <- as.POSIXct(strptime(bitcoin_trvou[,1], "%Y-%m-%d"))

currency_exchange_rates <- read.csv("data/CurrencyExchangeRates.csv", header=TRUE)
currency_exchange_rates[,1] <- as.POSIXct(strptime(currency_exchange_rates[,1], "%Y-%m-%d"))

gold_prices <- read.csv("data/Gold_prices.csv", header=TRUE, col.names = c("date", "USD_AM", "USD_PM", "GBP_AM",  "GBP_PM",  "EURO_AM", "EURO_PM"))
gold_prices[,1]  <- as.POSIXct(strptime(gold_prices[,1], "%Y-%m-%d"))

s_p_composite <- read.csv("data/S&PComposite.csv", header=TRUE)
s_p_composite[,1] <- as.POSIXct(strptime(s_p_composite[,1], "%Y-%m-%d"))

world_development_indicators <- read_excel("data/World_Development_Indicators.xlsx", sheet="Data", na=c(".."))

```

# Czyszczenie danych
```{r czyszczenie1, result='hide'}
gold_prices <- mutate(gold_prices,USD=f(USD_AM,  USD_PM), GBP=f(GBP_AM, GBP_PM), EURO=f(EURO_AM, EURO_PM)) %>% 
  select(date, USD, GBP, EURO) %>%
  gather(currency, value, USD:EURO) %>%
  mutate(currency=as.factor(currency))  %>%
  filter(!is.na(value))

#gold_prices$currency <- as.factor(gold_prices$currency )
s_p_composite <- gather(s_p_composite, measurment, value, S.P.Composite:Cyclically.Adjusted.PE.Ratio) %>%
  mutate(measurment=as.factor(measurment)) %>%
  filter(!is.na(value))

world_development_indicators <- gather(world_development_indicators,year, value, "1970 [YR1970]":"2020 [YR2020]") %>% 
  mutate(year=as.POSIXct(strptime(sprintf('%s-12-31',substr(year, 1, 4)), "%Y-%m-%d"))) %>% 
  rename(country_name=`Country Name`, indicator=`Series Name`) %>%
  mutate(country_name=as.factor(country_name), indicator=as.factor(indicator)) %>%
  filter(!is.na(value)) %>%
  select(country_name, indicator, year, value)
```

# Podsumowanie rozmiaru zbioru, podstawowe statystyki i analiza atrybutów

## Bitcoin
### Trudność znalezienia nowego bloku
Statystki 
```{r statystyki_bitcoin_diff, echo=FALSE}
knitr::kable(summary(bitcoin_diff))
```

```{r pomoc_bitcoin_diff, echo=FALSE}
n <- nrow(bitcoin_diff)
min_date <- min(bitcoin_diff$Date)
max_date <- max(bitcoin_diff$Date)

```
Zbiór zawiera `r n` obserwacji reprezentujących trudność znalezienia nowego bloku podczas kopania kryptowaluty z okresu między `r min_date` a `r max_date`. Na poniższym wykresie widać, że wartości zaczęły gwałtownie rosnąć od 2017 roku z wyraźniejszymi spadkami w roku 2019 i 2021.

```{r wykres_bitcoin_diff, echo=FALSE}
ggplot(bitcoin_diff, aes(x=Date, y=Value)) + geom_line(color='red') + labs(x="Data", y="Wartość", title="Trudność znalezienia nowego bloku") +   scale_x_datetime(breaks = "1 year", date_labels = "%Y") + theme_light()

```

### Szacowana liczba tera haszy na sekundę wykonywanych przez sieć Bitcoina
Statystyki
```{r statystyki_bitcoin_hrate, echo=FALSE}
knitr::kable(summary(bitcoin_hrate))
```

```{r pomoc_bitcoin_hrate, echo=FALSE}
n <- nrow(bitcoin_hrate)
min_date <- min(bitcoin_hrate$Date)
max_date <- max(bitcoin_hrate$Date)
joined = inner_join(bitcoin_hrate, bitcoin_diff, by="Date")
cor <- cor(joined$Value.x, joined$Value.y)
```
Zbiór zawiera `r n` obserwacji przedstawiających liczbę tera haszy na sekundę wykonywanych przez sieć Bitcoina w okresie od `r min_date` do `r max_date`. Na poniższym wykresie widać podobny trend jak w przypadku trudności znalezienia nowego bloku. Potwierdza to współczynnik korelacji Pearsona, który wynosi `r cor`.

```{r wykres_bitcoin_hrate, echo=FALSE}
ggplot(bitcoin_hrate, aes(x=Date, y=Value))  + geom_line(color='green') + labs(x="Data", y="Wartość", title="Tera hasze na sekundę") + scale_x_datetime(breaks = "1 year", date_labels = "%Y") + theme_light()

```

### Średnia wartość w USD
Statystyki
```{r statystyki_bitcoin_mkpru, echo=FALSE}
knitr::kable(summary(bitcoin_mkpru))
```

```{r pomoc_bitcoin_mkpru, echo=FALSE}
options(scipen=999)
n <- nrow(bitcoin_mkpru)
min_date <- min(bitcoin_mkpru$Date)
max_date <- max(bitcoin_mkpru$Date)
min <- min(bitcoin_mkpru$Value)
max <- round(max(bitcoin_mkpru$Value),2)
mean <- mean(bitcoin_mkpru$Value)

joined1 = inner_join(bitcoin_mkpru, bitcoin_diff, by="Date")
cor1 <- cor(joined1$Value.x, joined1$Value.y)

joined2 = inner_join(bitcoin_hrate, bitcoin_mkpru, by="Date")
cor2 <- cor(joined2$Value.x, joined2$Value.y)
```
Zbiór zaweierający wartości Bitcoina w dolarach zawiera `r n` obserwacji. W okresie od `r min_date` do `r max_date` najwyższa warość Bitocina wyniosła `r  max` dolarów, a średnia `r round(mean, 2)` dolarów. Duży spadek, który można zaobserwować w połowie 2021 roku spowodowany został zapowiedziami Chińskiego rządu dotyczącymi regulacji odnośnie kryptowalut oraz tweetami Elona Muska na temat zablokowania możliwości płacenia za samochody marki Tesla w tej kryptowalucie czy sprzedaży przez tę firmę sprzedaży posiadanych Bitcoinów o wartości 1,5 mld dolarów (https://pl.wikipedia.org/wiki/Bitcoin#Rynek). Wykres wygląda podobnie do wykresu trudności znaleziania nowego bloku i szacowanej liczby tera haszy na sekunde co potwierdzają wartości współczynnika korelacji Pearsona, które wynoszą odpowiednio `r round(cor1,2)` i `r round(cor2,2)`. 

```{r wykres_bitcoin_mkpru, echo=FALSE}
ggplot(bitcoin_mkpru, aes(x=Date, y=Value))  + geom_line(color='blue') + labs(x="Data", y="Wartość w dollarach", title="Zmiana wartości Bitcoina w czasie") + scale_x_datetime(breaks = "1 year", date_labels = "%Y") + theme_light()

```
Korelację między trudnością znalezienia nowego bloku, szacowaną liczbą tera haszy na sekundę i wartością Bitcoina w dolarach można pokazać na jednym wykresie. W celu czytelenego pokazania wszystkich zmiennych wartości poszczególnych miar zostały znormalizowane. 
```{r cor_help, echo=FALSE}
ggplot() + 
  geom_line(data=bitcoin_mkpru, aes(x=Date, y=(Value-min(Value))/(max(Value)-min(Value)), color='xd'), color='blue') + 
  geom_line(data=bitcoin_hrate, aes(x=Date, y=(Value-min(Value))/(max(Value)-min(Value))), color='green') + 
  geom_line(data=bitcoin_diff, aes(x=Date, y=(Value-min(Value))/(max(Value)-min(Value))), color='red')  + 
  labs(x="Data", y="Znormalizowana warość", title="Korelacj znormalizowanych wartości dla Bitcoina") + 
  scale_x_datetime(breaks = "1 year", date_labels = "%Y") + 
  theme_light()
```

### Wartość w USD wolumenu obrotu
Statystyki
```{r statystyki_bitcoin_trvou, echo=FALSE}
knitr::kable(summary(bitcoin_trvou))
```

```{r pomoc_bitcoin_trvou, echo=FALSE}
options(scipen=999)
n <- nrow(bitcoin_mkpru)
min_date <- min(bitcoin_trvou$Date)
max_date <- max(bitcoin_trvou$Date)
m <- bitcoin_trvou %>% filter(Value == max(Value))

joined = inner_join(bitcoin_mkpru, bitcoin_trvou, by="Date")
cor <- cor(joined$Value.x, joined$Value.y)

joined2 = inner_join(bitcoin_hrate, bitcoin_trvou, by="Date")
cor2 <- cor(joined2$Value.x, joined2$Value.y)
```
Zbiór zaweierający wartość obrotu Bitcoina wyrażony w dolarach zawiera `r n` obserwacji. Najwyższy obrót o wartości `r m$Value` USD odnotowano dnia `r m$Date`. Korelacja tej miary z wartością Bitcoina w dolarach wynosi `r round(cor,2)` a z liczbą tera haszy na sekundę `r round(cor2,2)`. Obie te korelacje są małe.

```{r wykres_bitcoin_trvou, echo=FALSE}
ggplot(bitcoin_trvou, aes(x=Date, y=Value))  + geom_line(color='yellow') + labs(x="Data", y="Wartość", title="Zmiana wartości wolumenu obrotu w dolarach w") + scale_x_datetime(breaks = "1 year", date_labels = "%Y") + theme_light()

```

## Cena złota

### EURO
Statystyki
```{r statystyki_euro, echo=FALSE}

knitr::kable(summary(gold_prices %>% filter(as.numeric(currency) == 1)))
```

### Funt brytyjski
Statystyki
```{r statystyki_funt, echo=FALSE}
knitr::kable(summary(gold_prices %>% filter(as.numeric(currency) == 2)))
```

### Dolar amerykański
Statystyki
```{r statystyki_dolar, echo=FALSE}
knitr::kable(summary(gold_prices %>% filter(as.numeric(currency) == 3)))
```

## Wyniki S&P Composite
Statystyki
```{r statystyki_s_p_composite, echo=FALSE}
knitr::kable(summary(s_p_composite, maxsum = 9))
```

## Wskażniki rozwoju na świecie
Statystyki
```{r statystyki_indicators, echo=FALSE}
knitr::kable(summary(world_development_indicators))
```
Zbiór opisuje `r length(unique(world_development_indicators$country_name))` państw przy pomocy `r length(unique(world_development_indicators$indicator))` wskaźników.
```{r n_country, echo=FALSE}
length(unique(world_development_indicators$country_name))
```
Liczba wskaźników
```{r n_ind, echo=FALSE}
length(unique(world_development_indicators$indicator))
```